<Window
    x:Class="IDS.Frontend.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:vm="clr-namespace:IDS.Frontend.ViewModels"
    xmlns:conv="clr-namespace:IDS.Frontend.Converters"
    Title="IDS Console"
    Height="620"
    Width="1020"
    Background="#121212"
    WindowStartupLocation="CenterScreen">

    <!-- DATA CONTEXT -->
    <Window.DataContext>
        <vm:AlertListViewModel/>
    </Window.DataContext>

    <!-- RESOURCES -->
    <Window.Resources>

        <!-- Typography -->
        <Style x:Key="TitleText" TargetType="TextBlock">
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="White"/>
        </Style>

        <Style x:Key="LabelText" TargetType="TextBlock">
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Foreground" Value="#AAAAAA"/>
        </Style>
        <!-- TextBox with hint / placeholder -->
        <Style x:Key="HintTextBox" TargetType="TextBox">
            <Setter Property="Background" Value="#1E1E1E"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="#333333"/>
            <Setter Property="Padding" Value="6"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Grid>
                            <ScrollViewer x:Name="PART_ContentHost"/>

                            <!-- Hint text -->
                            <TextBlock x:Name="Hint"
                               Text="{TemplateBinding Tag}"
                               Foreground="#777777"
                               Margin="8,0,0,0"
                               VerticalAlignment="Center"
                               IsHitTestVisible="False"
                               Visibility="Collapsed"/>
                        </Grid>

                        <ControlTemplate.Triggers>
                            <!-- Show hint only when empty AND not focused -->
                            <MultiTrigger>
                                <MultiTrigger.Conditions>
                                    <Condition Property="Text" Value=""/>
                                    <Condition Property="IsKeyboardFocused" Value="False"/>
                                </MultiTrigger.Conditions>
                                <Setter TargetName="Hint"
                                Property="Visibility"
                                Value="Visible"/>
                            </MultiTrigger>

                            <!-- Hide hint on focus -->
                            <Trigger Property="IsKeyboardFocused" Value="True">
                                <Setter TargetName="Hint"
                                Property="Visibility"
                                Value="Collapsed"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="ValueText" TargetType="TextBlock">
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Foreground" Value="White"/>
        </Style>

        <!-- ComboBox base -->
        <Style TargetType="ComboBox">
            <Setter Property="Background" Value="#1E1E1E"/>
            <Setter Property="Foreground" Value="Black"/>
            <Setter Property="BorderBrush" Value="#333333"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="6,2"/>
        </Style>

        <!-- ComboBox dropdown items -->
        <Style TargetType="ComboBoxItem">
            <Setter Property="Background" Value="#1E1E1E"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Padding" Value="6,4"/>

            <Style.Triggers>
                <!-- Hover -->
                <Trigger Property="IsHighlighted" Value="True">
                    <Setter Property="Background" Value="#2A2A2A"/>
                </Trigger>

                <!-- Selected -->
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="#333333"/>
                    <Setter Property="FontWeight" Value="SemiBold"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Severity -->
        <conv:SeverityToBrushConverter x:Key="SeverityBrush"/>
        <conv:SpeedToBrushConverter x:Key="SpeedBrush"/>
        <conv:SpeedToWidthConverter x:Key="SpeedWidth"/>

    </Window.Resources>

    <!-- ROOT GRID -->
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="44"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="30"/>
        </Grid.RowDefinitions>

        <!-- TOP BAR -->
        <Border Grid.Row="0" Background="#1E1E1E">
            <TextBlock Text="Intrusion Detection System"
                       Style="{StaticResource TitleText}"
                       VerticalAlignment="Center"
                       Margin="16,0"/>
        </Border>

        <!-- MAIN CONTENT -->
        <Grid Grid.Row="1" Margin="10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" MinWidth="500"/>
                <ColumnDefinition Width="6"/>
                <ColumnDefinition Width="340" MinWidth="280"/>
            </Grid.ColumnDefinitions>

            <!-- LEFT SIDE -->
            <Grid Grid.Column="0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- SEARCH + FILTER -->
                <StackPanel Orientation="Horizontal"
                            Margin="0,0,0,8">

                    <TextBox Width="240"
         Height="26"
         Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
         Style="{StaticResource HintTextBox}"
         Tag="Enter IP only"
         Margin="0,0,8,0"/>


                    <ComboBox Width="120"
                              Height="26"
                              SelectedValue="{Binding SeverityFilter}"
                              SelectedValuePath="Content">
                        <ComboBoxItem Content="All"/>
                        <ComboBoxItem Content="High"/>
                        <ComboBoxItem Content="Medium"/>
                        <ComboBoxItem Content="Low"/>
                    </ComboBox>
                </StackPanel>

                <!-- ALERT TABLE -->
                <Border Grid.Row="1" ClipToBounds="True">
                    <DataGrid
                        ItemsSource="{Binding AlertsView}"
                        SelectedItem="{Binding SelectedAlert}"
                        AutoGenerateColumns="False"
                        IsReadOnly="True"
                        Background="#121212"
                        Foreground="White"
                        GridLinesVisibility="None"
                        HeadersVisibility="Column"
                        BorderThickness="0"
                        RowHeight="32"
                        ScrollViewer.VerticalScrollBarVisibility="Auto">

                        <DataGrid.ColumnHeaderStyle>
                            <Style TargetType="DataGridColumnHeader">
                                <Setter Property="Background" Value="#1E1E1E"/>
                                <Setter Property="Foreground" Value="White"/>
                                <Setter Property="FontWeight" Value="SemiBold"/>
                                <Setter Property="BorderThickness" Value="0"/>
                                <Setter Property="Padding" Value="8,6"/>
                            </Style>
                        </DataGrid.ColumnHeaderStyle>

                        <DataGrid.RowStyle>
                            <Style TargetType="DataGridRow">
                                <Setter Property="Background"
                                        Value="{Binding Severity,
                                                Converter={StaticResource SeverityBrush}}"/>
                                <Setter Property="Foreground" Value="White"/>

                                <Style.Triggers>
                                    <Trigger Property="IsSelected" Value="True">
                                        <Setter Property="Background"
                                                Value="{Binding Severity,
                                                        Converter={StaticResource SeverityBrush},
                                                        ConverterParameter=Selected}"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </DataGrid.RowStyle>

                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Time" Binding="{Binding Time}" Width="170"/>
                            <DataGridTextColumn Header="Severity" Binding="{Binding Severity}" Width="90"/>
                            <DataGridTextColumn Header="Source" Binding="{Binding SourceIP}" Width="150"/>
                            <DataGridTextColumn Header="Destination" Binding="{Binding DestinationIP}" Width="150"/>
                            <DataGridTemplateColumn Header="Speed (KB/s)" Width="130">
    <DataGridTemplateColumn.CellTemplate>
        <DataTemplate>
            <Grid Height="22">
                <!-- Background bar (Task Manager style) -->
                <Border
                    Background="{Binding SpeedKbps, Converter={StaticResource SpeedBrush}}"
                    Opacity="0.35"
                    CornerRadius="3"
                    HorizontalAlignment="Left"
                    Width="{Binding SpeedKbps, Converter={StaticResource SpeedWidth}}"
                    MaxWidth="120"/>

                <!-- Speed text -->
                <TextBlock
                    Text="{Binding SpeedKbps, StringFormat={}{0:F1}}"
                    Foreground="White"
                    FontSize="12"
                    VerticalAlignment="Center"
                    Margin="6,0,0,0"/>
            </Grid>
        </DataTemplate>
    </DataGridTemplateColumn.CellTemplate>
</DataGridTemplateColumn>

                            <DataGridTextColumn Header="Type" Binding="{Binding DetectionType}" Width="80"/>
                            <DataGridTextColumn Header="Summary" Binding="{Binding Summary}" Width="*"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </Border>
            </Grid>

            <!-- SPLITTER -->
            <GridSplitter Grid.Column="1"
                          Width="6"
                          Background="#2A2A2A"
                          ResizeBehavior="PreviousAndNext"
                          ResizeDirection="Columns"/>

            <!-- DETAILS PANEL -->
            <Border Grid.Column="2" Background="#1A1A1A" Padding="14">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel>

                        <TextBlock Text="Alert Details"
                                   Style="{StaticResource TitleText}"
                                   Margin="0,0,0,16"/>

                        <TextBlock Text="Severity" Style="{StaticResource LabelText}"/>
                        <TextBlock Text="{Binding SelectedAlert.Severity}"
                                   Foreground="{Binding SelectedAlert.Severity,
                                                        Converter={StaticResource SeverityBrush}}"
                                   FontWeight="Bold"
                                   Margin="0,2,0,12"/>

                        <TextBlock Text="Detection Type" Style="{StaticResource LabelText}"/>
                        <TextBlock Text="{Binding SelectedAlert.DetectionType}"
                                   Style="{StaticResource ValueText}"
                                   Margin="0,2,0,12"/>

                        <TextBlock Text="Timestamp" Style="{StaticResource LabelText}"/>
                        <TextBlock Text="{Binding SelectedAlert.Time,
                                                  StringFormat={}{0:yyyy-MM-dd HH:mm:ss}}"
                                   Style="{StaticResource ValueText}"
                                   Margin="0,2,0,12"/>

                        <TextBlock Text="Source IP" Style="{StaticResource LabelText}"/>
                        <TextBlock Text="{Binding SelectedAlert.SourceIP}"
                                   Style="{StaticResource ValueText}"
                                   Margin="0,2,0,12"/>

                        <TextBlock Text="Destination IP" Style="{StaticResource LabelText}"/>
                        <TextBlock Text="{Binding SelectedAlert.DestinationIP}"
                                   Style="{StaticResource ValueText}"
                                   Margin="0,2,0,12"/>

                        <TextBlock Text="Summary" Style="{StaticResource LabelText}"/>
                        <TextBlock Text="{Binding SelectedAlert.Summary}"
                                   Foreground="#CCCCCC"
                                   TextWrapping="Wrap"/>
                    </StackPanel>
                </ScrollViewer>
            </Border>
        </Grid>

        <!-- STATUS BAR -->
        <Border Grid.Row="2" Background="#1E1E1E" Padding="12,0">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="20"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="20"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Backend status -->
                <StackPanel Orientation="Horizontal"
                    VerticalAlignment="Center">
                    <Ellipse Width="8"
                     Height="8"
                     Fill="Red"
                     Margin="0,0,6,0"/>
                    <TextBlock Text="Backend:"
                       Foreground="#AAAAAA"
                       FontSize="12"/>
                    <TextBlock Text="{Binding BackendStatus}"
                       Foreground="White"
                       FontSize="12"
                       Margin="4,0,0,0"/>
                </StackPanel>

                <!-- Total alerts -->
                <TextBlock Grid.Column="2"
                   Text="{Binding TotalAlerts, StringFormat=Alerts: {0}}"
                   Foreground="White"
                   FontSize="12"
                   VerticalAlignment="Center"/>

                <!-- High severity -->
                <TextBlock Grid.Column="4"
                   Text="{Binding HighSeverityCount, StringFormat=High: {0}}"
                   Foreground="#FF6B6B"
                   FontSize="12"
                   VerticalAlignment="Center"/>

                <!-- Last updated -->
                <TextBlock Grid.Column="5"
                   Text="{Binding LastUpdated, StringFormat=Updated: {0:T}}"
                   Foreground="#888888"
                   FontSize="12"
                   VerticalAlignment="Center"
                   HorizontalAlignment="Right"/>
            </Grid>
        </Border>

    </Grid>
</Window>
